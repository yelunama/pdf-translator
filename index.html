<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF专业翻译工具</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- GSAP 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#8b5cf6',
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.37)',
                        'neu': '20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .glass-effect {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(4px);
                -webkit-backdrop-filter: blur(4px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                color: transparent;
                background-image: linear-gradient(90deg, #3b82f6, #8b5cf6);
            }
            
            .btn-hover {
                @apply transition-all duration-300 hover:shadow-lg transform hover:-translate-y-1;
            }
            
            .progress-bar {
                @apply h-2 rounded-full bg-gray-200 overflow-hidden;
            }
            
            .progress-value {
                @apply h-full bg-gradient-to-r from-primary to-accent transition-all duration-300;
            }
            
            .pdf-page {
                @apply border border-gray-200 rounded-lg shadow-md overflow-hidden mb-4;
            }
            
            .page-number {
                @apply absolute top-2 right-2 bg-primary text-white text-xs px-2 py-1 rounded-full;
            }
            
            .loading-spinner {
                @apply w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin;
            }
            
            .translation-badge {
                @apply absolute top-2 left-2 bg-secondary text-white text-xs px-2 py-1 rounded-full;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="glass-effect sticky top-0 z-50 shadow-md">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-file-pdf-o text-2xl text-red-500"></i>
                <h1 class="text-xl font-bold text-gradient">PDF专业翻译工具</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <i class="fa fa-moon-o text-gray-600"></i>
                </button>
                <button id="help-button" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                    <i class="fa fa-question-circle text-gray-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 欢迎区域 -->
        <section id="welcome-section" class="mb-12 text-center">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-4xl font-bold mb-4 text-dark">专业级PDF文档翻译</h2>
                <p class="text-lg text-gray-600 mb-8">上传您的英文PDF文档，我们将为您提供高质量的中文翻译，同时保留原始格式和排版。</p>
                
                <!-- 文件上传区域 -->
                <div id="upload-container" class="glass-effect rounded-2xl p-8 mb-8 transition-all duration-500 hover:shadow-glass">
                    <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-xl p-12 cursor-pointer hover:border-primary transition-colors">
                        <i class="fa fa-cloud-upload text-5xl text-gray-400 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">拖放PDF文件到此处</h3>
                        <p class="text-gray-500 mb-4">或</p>
                        <label class="inline-block">
                            <span class="bg-primary text-white px-6 py-3 rounded-lg font-medium btn-hover">
                                选择PDF文件
                            </span>
                            <input type="file" id="file-input" accept=".pdf" class="hidden">
                        </label>
                        <p class="text-sm text-gray-500 mt-4">支持最大20MB的PDF文件</p>
                    </div>
                </div>
                
                <!-- 最近文件区域 -->
                <div id="recent-files" class="hidden">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">最近处理的文件</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="recent-files-list">
                        <!-- 最近文件将在这里动态添加 -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 处理中区域 -->
        <section id="processing-section" class="hidden mb-12">
            <div class="max-w-3xl mx-auto glass-effect rounded-2xl p-8 text-center">
                <div class="loading-spinner mx-auto mb-6"></div>
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">正在处理您的文档</h3>
                <p class="text-gray-600 mb-6" id="processing-status">正在提取PDF内容...</p>
                
                <!-- 进度条 -->
                <div class="progress-bar mb-4">
                    <div id="progress-value" class="progress-value" style="width: 0%"></div>
                </div>
                <p class="text-sm text-gray-500" id="progress-text">0%</p>
                
                <button id="cancel-processing" class="mt-6 text-gray-600 hover:text-red-500 transition-colors">
                    <i class="fa fa-times-circle mr-2"></i>取消处理
                </button>
            </div>
        </section>
        
        <!-- 结果预览区域 -->
        <section id="result-section" class="hidden">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-dark mb-2" id="result-filename">文档名称</h2>
                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                            <span><i class="fa fa-clock-o mr-1"></i> <span id="result-timestamp">处理时间</span></span>
                            <span><i class="fa fa-file-text-o mr-1"></i> <span id="result-pages">页数</span></span>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="download-original" class="flex items-center bg-gray-200 text-gray-700 px-4 py-2 rounded-lg btn-hover">
                            <i class="fa fa-download mr-2"></i>下载原文
                        </button>
                        <button id="download-translated" class="flex items-center bg-primary text-white px-4 py-2 rounded-lg btn-hover">
                            <i class="fa fa-download mr-2"></i>下载译文
                        </button>
                    </div>
                </div>
                
                <!-- 视图切换选项 -->
                <div class="flex border-b border-gray-200 mb-6">
                    <button id="view-side-by-side" class="px-4 py-2 border-b-2 border-primary text-primary font-medium">
                        对照视图
                    </button>
                    <button id="view-original" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                        仅原文
                    </button>
                    <button id="view-translated" class="px-4 py-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                        仅译文
                    </button>
                </div>
                
                <!-- PDF预览区域 -->
                <div id="pdf-preview" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 原文页面将在这里动态添加 -->
                </div>
                
                <!-- 翻译质量评分 -->
                <div class="mt-8 glass-effect rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">翻译质量评估</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">准确性</span>
                                <span class="font-semibold text-primary" id="accuracy-score">95%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-value" style="width: 95%"></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">流畅度</span>
                                <span class="font-semibold text-primary" id="fluency-score">92%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-value" style="width: 92%"></div>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">术语一致性</span>
                                <span class="font-semibold text-primary" id="consistency-score">90%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-value" style="width: 90%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 操作按钮 -->
                <div class="mt-8 flex justify-center space-x-4">
                    <button id="new-translation" class="bg-primary text-white px-6 py-3 rounded-lg font-medium btn-hover">
                        <i class="fa fa-plus mr-2"></i>新的翻译
                    </button>
                    <button id="share-result" class="bg-secondary text-white px-6 py-3 rounded-lg font-medium btn-hover">
                        <i class="fa fa-share-alt mr-2"></i>分享结果
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">关于我们</h3>
                    <p class="text-gray-400">PDF专业翻译工具提供高质量的文档翻译服务，帮助您跨越语言障碍，高效处理国际文档。</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">功能特点</h3>
                    <ul class="text-gray-400 space-y-2">
                        <li><i class="fa fa-check text-secondary mr-2"></i>保留原始格式排版</li>
                        <li><i class="fa fa-check text-secondary mr-2"></i>专业级翻译质量</li>
                        <li><i class="fa fa-check text-secondary mr-2"></i>批量文档处理</li>
                        <li><i class="fa fa-check text-secondary mr-2"></i>安全加密传输</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">联系我们</h3>
                    <ul class="text-gray-400 space-y-2">
                        <li><i class="fa fa-envelope mr-2"></i>support@pdftranslator.com</li>
                        <li><i class="fa fa-phone mr-2"></i>+86 123 4567 8910</li>
                        <li><i class="fa fa-map-marker mr-2"></i>北京市海淀区中关村科技园</li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-500">
                <p>&copy; 2025 PDF专业翻译工具. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- 帮助模态框 -->
    <div id="help-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-gray-800">使用帮助</h3>
                    <button id="close-help" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700">如何使用PDF翻译工具</h4>
                        <ol class="list-decimal pl-5 mt-2 space-y-2 text-gray-600">
                            <li>点击"选择PDF文件"按钮或直接拖放PDF文件到上传区域</li>
                            <li>等待文件上传并自动开始翻译过程</li>
                            <li>翻译完成后，您可以在对照视图中查看原文和译文</li>
                            <li>使用"下载译文"按钮获取翻译后的PDF文件</li>
                        </ol>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700">支持的文件格式</h4>
                        <p class="text-gray-600">目前我们仅支持PDF格式的文件，最大文件大小为20MB。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700">翻译语言</h4>
                        <p class="text-gray-600">当前版本支持从英语翻译到中文。我们计划在未来添加更多语言对。</p>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-700">隐私与安全</h4>
                        <p class="text-gray-600">我们重视您的隐私，所有上传的文件仅用于翻译目的，并在处理完成后从服务器删除。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 分享模态框 -->
    <div id="share-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">分享翻译结果</h3>
                    <button id="close-share" class="text-gray-500 hover:text-gray-700">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 mb-2">分享链接</label>
                    <div class="flex">
                        <input type="text" id="share-link" value="https://pdftranslator.com/share/abc123" readonly
                               class="flex-1 border border-gray-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary">
                        <button id="copy-link" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-primary-dark transition-colors">
                            <i class="fa fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 mb-2">分享到社交媒体</label>
                    <div class="flex space-x-4 justify-center">
                        <button class="w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center hover:bg-blue-700 transition-colors">
                            <i class="fa fa-weixin"></i>
                        </button>
                        <button class="w-10 h-10 rounded-full bg-blue-400 text-white flex items-center justify-center hover:bg-blue-500 transition-colors">
                            <i class="fa fa-weibo"></i>
                        </button>
                        <button class="w-10 h-10 rounded-full bg-green-600 text-white flex items-center justify-center hover:bg-green-700 transition-colors">
                            <i class="fa fa-qq"></i>
                        </button>
                    </div>
                </div>
                <button id="close-share-btn" class="w-full bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let currentPDF = null;
        let currentFile = null;
        let processingInterval = null;
        let currentView = 'side-by-side';
        
        // DOM元素
        const uploadContainer = document.getElementById('upload-container');
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const welcomeSection = document.getElementById('welcome-section');
        const processingSection = document.getElementById('processing-section');
        const resultSection = document.getElementById('result-section');
        const processingStatus = document.getElementById('processing-status');
        const progressValue = document.getElementById('progress-value');
        const progressText = document.getElementById('progress-text');
        const cancelProcessing = document.getElementById('cancel-processing');
        const resultFilename = document.getElementById('result-filename');
        const resultTimestamp = document.getElementById('result-timestamp');
        const resultPages = document.getElementById('result-pages');
        const pdfPreview = document.getElementById('pdf-preview');
        const viewSideBySide = document.getElementById('view-side-by-side');
        const viewOriginal = document.getElementById('view-original');
        const viewTranslated = document.getElementById('view-translated');
        const downloadOriginal = document.getElementById('download-original');
        const downloadTranslated = document.getElementById('download-translated');
        const newTranslation = document.getElementById('new-translation');
        const shareResult = document.getElementById('share-result');
        const helpButton = document.getElementById('help-button');
        const helpModal = document.getElementById('help-modal');
        const closeHelp = document.getElementById('close-help');
        const shareModal = document.getElementById('share-modal');
        const closeShare = document.getElementById('close-share');
        const closeShareBtn = document.getElementById('close-share-btn');
        const copyLink = document.getElementById('copy-link');
        const themeToggle = document.getElementById('theme-toggle');
        const recentFiles = document.getElementById('recent-files');
        const recentFilesList = document.getElementById('recent-files-list');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 加载最近文件
            loadRecentFiles();
            
            // 设置PDF.js worker
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
            
            // 事件监听
            setupEventListeners();
        });
        
        // 设置事件监听
        function setupEventListeners() {
            // 文件上传相关
            fileInput.addEventListener('change', handleFileSelect);
            dropArea.addEventListener('click', () => fileInput.click());
            
            // 拖放功能
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('border-primary');
            }
            
            function unhighlight() {
                dropArea.classList.remove('border-primary');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            }
            
            // 处理相关
            cancelProcessing.addEventListener('click', cancelProcess);
            
            // 视图切换
            viewSideBySide.addEventListener('click', () => switchView('side-by-side'));
            viewOriginal.addEventListener('click', () => switchView('original'));
            viewTranslated.addEventListener('click', () => switchView('translated'));
            
            // 下载按钮
            downloadOriginal.addEventListener('click', downloadOriginalPDF);
            downloadTranslated.addEventListener('click', downloadTranslatedPDF);
            
            // 新翻译和分享
            newTranslation.addEventListener('click', startNewTranslation);
            shareResult.addEventListener('click', openShareModal);
            
            // 帮助模态框
            helpButton.addEventListener('click', () => helpModal.classList.remove('hidden'));
            closeHelp.addEventListener('click', () => helpModal.classList.add('hidden'));
            
            // 分享模态框
            closeShare.addEventListener('click', () => shareModal.classList.add('hidden'));
            closeShareBtn.addEventListener('click', () => shareModal.classList.add('hidden'));
            copyLink.addEventListener('click', copyShareLink);
            
            // 主题切换
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // 处理文件选择
        function handleFileSelect(e) {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        }
        
        // 处理文件
        function handleFile(file) {
            if (file.type !== 'application/pdf') {
                alert('请选择PDF文件！');
                return;
            }
            
            if (file.size > 20 * 1024 * 1024) {
                alert('文件大小不能超过20MB！');
                return;
            }
            
            currentFile = file;
            
            // 显示处理中界面
            welcomeSection.classList.add('hidden');
            processingSection.classList.remove('hidden');
            
            // 开始处理
            startProcessing();
        }
        
        // 开始处理
        function startProcessing() {
            let progress = 0;
            processingStatus.textContent = '正在提取PDF内容...';
            
            // 模拟处理进度
            processingInterval = setInterval(() => {
                progress += 5;
                
                if (progress <= 30) {
                    processingStatus.textContent = '正在提取PDF内容...';
                } else if (progress <= 60) {
                    processingStatus.textContent = '正在进行专业翻译...';
                } else if (progress < 100) {
                    processingStatus.textContent = '正在保留原始格式...';
                } else {
                    processingStatus.textContent = '处理完成！';
                    clearInterval(processingInterval);
                    
                    // 延迟显示结果
                    setTimeout(() => {
                        showResult();
                    }, 500);
                }
                
                updateProgress(progress);
            }, 200);
            
            // 实际处理PDF
            processPDF(currentFile);
        }
        
        // 更新进度条
        function updateProgress(progress) {
            progressValue.style.width = `${progress}%`;
            progressText.textContent = `${progress}%`;
        }
        
        // 取消处理
        function cancelProcess() {
            clearInterval(processingInterval);
            processingSection.classList.add('hidden');
            welcomeSection.classList.remove('hidden');
            currentFile = null;
        }
        
        // 处理PDF
        function processPDF(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                
                pdfjsLib.getDocument(data).promise.then(pdf => {
                    currentPDF = pdf;
                    
                    // 模拟翻译完成后显示结果
                    // 实际应用中，这里应该调用翻译API
                }).catch(error => {
                    console.error('Error processing PDF:', error);
                    alert('处理PDF时出错，请重试！');
                    cancelProcess();
                });
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // 显示结果
        function showResult() {
            processingSection.classList.add('hidden');
            resultSection.classList.remove('hidden');
            
            // 设置结果信息
            resultFilename.textContent = currentFile.name;
            resultTimestamp.textContent = new Date().toLocaleString();
            resultPages.textContent = `${currentPDF.numPages}页`;
            
            // 渲染PDF页面
            renderPDFPages();
            
            // 保存到最近文件
            saveToRecentFiles(currentFile.name);
        }
        
        // 渲染PDF页面
        function renderPDFPages() {
            pdfPreview.innerHTML = '';
            
            // 只渲染前3页作为预览
            const pagesToRender = Math.min(3, currentPDF.numPages);
            
            for (let i = 1; i <= pagesToRender; i++) {
                renderPage(i);
            }
            
            // 如果有更多页面，显示提示
            if (currentPDF.numPages > 3) {
                const morePages = document.createElement('div');
                morePages.className = 'col-span-1 lg:col-span-2 text-center py-8 bg-gray-50 rounded-lg';
                morePages.innerHTML = `
                    <i class="fa fa-file-pdf-o text-3xl text-red-500 mb-2"></i>
                    <p class="text-gray-600">还有 ${currentPDF.numPages - 3} 页未显示</p>
                    <p class="text-sm text-gray-500">下载完整译文查看所有页面</p>
                `;
                pdfPreview.appendChild(morePages);
            }
        }
        
        // 渲染单页
        function renderPage(pageNum) {
            currentPDF.getPage(pageNum).then(page => {
                const scale = 1.5;
                const viewport = page.getViewport({ scale });
                
                // 创建原文canvas
                const originalCanvas = document.createElement('canvas');
                originalCanvas.className = 'w-full h-auto';
                originalCanvas.width = viewport.width;
                originalCanvas.height = viewport.height;
                
                // 创建译文canvas（克隆原文）
                const translatedCanvas = document.createElement('canvas');
                translatedCanvas.className = 'w-full h-auto';
                translatedCanvas.width = viewport.width;
                translatedCanvas.height = viewport.height;
                
                // 渲染原文
                const renderContext = {
                    canvasContext: originalCanvas.getContext('2d'),
                    viewport
                };
                
                page.render(renderContext).promise.then(() => {
                    // 复制到译文canvas
                    const translatedCtx = translatedCanvas.getContext('2d');
                    translatedCtx.drawImage(originalCanvas, 0, 0);
                    
                    // 添加翻译标记
                    translatedCtx.fillStyle = 'rgba(16, 185, 129, 0.1)';
                    translatedCtx.fillRect(0, 0, viewport.width, viewport.height);
                    
                    // 创建页面容器
                    const originalPage = document.createElement('div');
                    originalPage.className = 'pdf-page relative overflow-hidden';
                    originalPage.appendChild(originalCanvas);
                    
                    const pageNumberBadge = document.createElement('div');
                    pageNumberBadge.className = 'page-number';
                    pageNumberBadge.textContent = `第 ${pageNum} 页`;
                    originalPage.appendChild(pageNumberBadge);
                    
                    const translatedPage = document.createElement('div');
                    translatedPage.className = 'pdf-page relative overflow-hidden';
                    translatedPage.appendChild(translatedCanvas);
                    
                    const translationBadge = document.createElement('div');
                    translationBadge.className = 'translation-badge';
                    translationBadge.textContent = '已翻译';
                    translatedPage.appendChild(translationBadge);
                    
                    const pageNumberBadge2 = document.createElement('div');
                    pageNumberBadge2.className = 'page-number';
                    pageNumberBadge2.textContent = `第 ${pageNum} 页`;
                    translatedPage.appendChild(pageNumberBadge2);
                    
                    // 根据当前视图添加页面
                    if (currentView === 'side-by-side') {
                        pdfPreview.appendChild(originalPage);
                        pdfPreview.appendChild(translatedPage);
                    } else if (currentView === 'original') {
                        originalPage.className += ' col-span-1 lg:col-span-2';
                        pdfPreview.appendChild(originalPage);
                    } else if (currentView === 'translated') {
                        translatedPage.className += ' col-span-1 lg:col-span-2';
                        pdfPreview.appendChild(translatedPage);
                    }
                });
            });
        }
        
        // 切换视图
        function switchView(view) {
            currentView = view;
            
            // 更新按钮样式
            viewSideBySide.classList.remove('border-primary', 'text-primary');
            viewOriginal.classList.remove('border-primary', 'text-primary');
            viewTranslated.classList.remove('border-primary', 'text-primary');
            
            viewSideBySide.classList.add('border-transparent', 'text-gray-500');
            viewOriginal.classList.add('border-transparent', 'text-gray-500');
            viewTranslated.classList.add('border-transparent', 'text-gray-500');
            
            if (view === 'side-by-side') {
                viewSideBySide.classList.remove('border-transparent', 'text-gray-500');
                viewSideBySide.classList.add('border-primary', 'text-primary');
                pdfPreview.classList.remove('grid-cols-1');
                pdfPreview.classList.add('grid-cols-1', 'lg:grid-cols-2');
            } else {
                pdfPreview.classList.remove('lg:grid-cols-2');
                pdfPreview.classList.add('grid-cols-1');
                
                if (view === 'original') {
                    viewOriginal.classList.remove('border-transparent', 'text-gray-500');
                    viewOriginal.classList.add('border-primary', 'text-primary');
                } else {
                    viewTranslated.classList.remove('border-transparent', 'text-gray-500');
                    viewTranslated.classList.add('border-primary', 'text-primary');
                }
            }
            
            // 重新渲染页面
            renderPDFPages();
        }
        
        // 下载原文
        function downloadOriginalPDF() {
            const link = document.createElement('a');
            link.href = URL.createObjectURL(currentFile);
            link.download = currentFile.name;
            link.click();
        }
        
        // 下载译文
        function downloadTranslatedPDF() {
            // 在实际应用中，这里应该生成并下载翻译后的PDF
            // 这里仅作为演示，下载原文
            const link = document.createElement('a');
            link.href = URL.createObjectURL(currentFile);
            
            // 修改文件名，添加翻译标记
            const originalName = currentFile.name;
            const extensionIndex = originalName.lastIndexOf('.');
            const nameWithoutExt = originalName.substring(0, extensionIndex);
            const extension = originalName.substring(extensionIndex);
            
            link.download = `${nameWithoutExt}_translated${extension}`;
            link.click();
            
            // 显示下载成功动画
            showNotification('译文下载已开始');
        }
        
        // 开始新翻译
        function startNewTranslation() {
            resultSection.classList.add('hidden');
            welcomeSection.classList.remove('hidden');
            currentPDF = null;
            currentFile = null;
        }
        
        // 打开分享模态框
        function openShareModal() {
            shareModal.classList.remove('hidden');
        }
        
        // 复制分享链接
        function copyShareLink() {
            const shareLink = document.getElementById('share-link');
            shareLink.select();
            document.execCommand('copy');
            
            // 显示复制成功提示
            const originalText = copyLink.innerHTML;
            copyLink.innerHTML = '<i class="fa fa-check"></i>';
            
            setTimeout(() => {
                copyLink.innerHTML = originalText;
            }, 2000);
            
            showNotification('链接已复制到剪贴板');
        }
        
        // 切换主题
        function toggleTheme() {
            const body = document.body;
            const icon = themeToggle.querySelector('i');
            
            if (body.classList.contains('dark')) {
                body.classList.remove('dark');
                body.classList.remove('bg-gray-900');
                body.classList.add('bg-gradient-to-br', 'from-gray-50', 'to-gray-100');
                icon.classList.remove('fa-sun-o');
                icon.classList.add('fa-moon-o');
            } else {
                body.classList.add('dark');
                body.classList.remove('bg-gradient-to-br', 'from-gray-50', 'to-gray-100');
                body.classList.add('bg-gray-900');
                icon.classList.remove('fa-moon-o');
                icon.classList.add('fa-sun-o');
            }
        }
        
        // 保存到最近文件
        function saveToRecentFiles(filename) {
            let recentFiles = JSON.parse(localStorage.getItem('recentFiles') || '[]');
            
            // 添加新文件到开头
            recentFiles.unshift({
                name: filename,
                timestamp: new Date().toISOString()
            });
            
            // 只保留最近5个文件
            recentFiles = recentFiles.slice(0, 5);
            
            localStorage.setItem('recentFiles', JSON.stringify(recentFiles));
            
            // 更新最近文件显示
            loadRecentFiles();
        }
        
        // 加载最近文件
        function loadRecentFiles() {
            const recentFilesData = JSON.parse(localStorage.getItem('recentFiles') || '[]');
            
            if (recentFilesData.length > 0) {
                recentFiles.classList.remove('hidden');
                recentFilesList.innerHTML = '';
                
                recentFilesData.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow cursor-pointer';
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <i class="fa fa-file-pdf-o text-red-500 text-2xl mr-3"></i>
                            <div>
                                <h4 class="font-medium text-gray-800 truncate">${file.name}</h4>
                                <p class="text-xs text-gray-500">${new Date(file.timestamp).toLocaleString()}</p>
                            </div>
                        </div>
                    `;
                    
                    fileItem.addEventListener('click', () => {
                        // 在实际应用中，这里应该重新加载该文件
                        showNotification('功能开发中：重新加载最近文件');
                    });
                    
                    recentFilesList.appendChild(fileItem);
                });
            }
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-y-10 opacity-0 transition-all duration-300';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 显示通知
            setTimeout(() => {
                notification.classList.remove('translate-y-10', 'opacity-0');
            }, 10);
            
            // 3秒后隐藏
            setTimeout(() => {
                notification.classList.add('translate-y-10', 'opacity-0');
                
                // 移除元素
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 添加页面加载动画
        window.addEventListener('load', () => {
            gsap.from('header', { y: -50, opacity: 0, duration: 0.8, ease: 'power3.out' });
            gsap.from('h2', { y: 30, opacity: 0, duration: 0.8, delay: 0.2, ease: 'power3.out' });
            gsap.from('p', { y: 30, opacity: 0, duration: 0.8, delay: 0.4, ease: 'power3.out' });
            gsap.from('#upload-container', { y: 50, opacity: 0, duration: 0.8, delay: 0.6, ease: 'power3.out' });
        });
    </script>
</body>
</html>